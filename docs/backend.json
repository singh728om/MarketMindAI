{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a customer of the AI E-commerce Growth Agency. This entity holds customer-specific information, including their onboarding progress and marketplace preferences.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "The unique email address of the customer.",
          "format": "email"
        },
        "companyName": {
          "type": "string",
          "description": "The name of the customer's company or brand."
        },
        "onboardingStatus": {
          "type": "string",
          "description": "The current step or status of the customer's onboarding process (e.g., 'step1', 'completed')."
        },
        "marketplacePreferences": {
          "type": "array",
          "description": "A list of marketplaces the customer operates in or is interested in (e.g., 'Amazon', 'Flipkart', 'Myntra').",
          "items": {
            "type": "string"
          }
        },
        "goals": {
          "type": "array",
          "description": "A list of business goals the customer aims to achieve with the AI services (e.g., 'sales', 'CTR', 'conversion', 'listing quality').",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the user profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The timestamp when the user profile was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "companyName",
        "onboardingStatus",
        "marketplacePreferences",
        "goals",
        "createdAt",
        "updatedAt"
      ]
    },
    "Employee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Employee",
      "type": "object",
      "description": "Represents an internal employee or administrator of the AI E-commerce Growth Agency, used for internal login and service delivery.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Employee entity."
        },
        "email": {
          "type": "string",
          "description": "The unique email address of the employee.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the employee."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the employee."
        },
        "role": {
          "type": "string",
          "description": "The role of the employee within the agency (e.g., 'Admin', 'ServiceAgent', 'Manager')."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the employee profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The timestamp when the employee profile was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "role",
        "createdAt",
        "updatedAt"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents an overarching engagement or campaign initiated by a customer, under which multiple services and jobs may be executed.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Project entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the project (e.g., 'CHIC ELAN - Q4 Campaign')."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the project's scope and objectives."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to the UserProfile entity that owns this project. (Relationship: UserProfile 1:N Project)"
        },
        "status": {
          "type": "string",
          "description": "The current status of the project (e.g., 'Active', 'Archived', 'Onboarding')."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the project was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The timestamp when the project was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "userProfileId",
        "status",
        "createdAt",
        "updatedAt"
      ]
    },
    "Service": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Service",
      "type": "object",
      "description": "Defines an AI service offered by the agency (e.g., 'AI Photoshoot', 'Listing Optimizer Agent').",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Service entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the AI service (e.g., 'AI Photoshoot')."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of what the service provides."
        },
        "category": {
          "type": "string",
          "description": "The category the service belongs to (e.g., 'GenAI', 'Growth Intelligence')."
        },
        "expectedDurationMinutes": {
          "type": "number",
          "description": "The estimated time in minutes required to complete this service."
        },
        "price": {
          "type": "number",
          "description": "The price of the service, if applicable."
        },
        "defaultPromptTemplateId": {
          "type": "string",
          "description": "Reference to the default PromptTemplate used for this service. (Relationship: Service 1:N PromptTemplate)"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "category",
        "expectedDurationMinutes"
      ]
    },
    "PromptTemplate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PromptTemplate",
      "type": "object",
      "description": "Stores predefined prompt templates used by various AI agents, which can be edited in the UI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PromptTemplate entity."
        },
        "serviceId": {
          "type": "string",
          "description": "Reference to the Service entity that this prompt template is associated with. (Relationship: Service 1:N PromptTemplate)"
        },
        "name": {
          "type": "string",
          "description": "A descriptive name for the prompt template (e.g., 'Default Photoshoot Prompt')."
        },
        "templateContent": {
          "type": "string",
          "description": "The actual text content of the prompt template, potentially with placeholders."
        },
        "description": {
          "type": "string",
          "description": "A brief explanation of what this prompt template is used for."
        },
        "isGlobal": {
          "type": "boolean",
          "description": "Indicates if this template is globally available or specific to certain projects/users."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the prompt template was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The timestamp when the prompt template was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "serviceId",
        "name",
        "templateContent",
        "isGlobal",
        "createdAt",
        "updatedAt"
      ]
    },
    "ServiceOrder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ServiceOrder",
      "type": "object",
      "description": "Represents a customer's specific request or 'order' for a particular AI service within a project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ServiceOrder entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to the Project entity under which this service was ordered. (Relationship: Project 1:N ServiceOrder)"
        },
        "serviceId": {
          "type": "string",
          "description": "Reference to the Service entity that was ordered. (Relationship: Service 1:N ServiceOrder)"
        },
        "status": {
          "type": "string",
          "description": "The current status of the service order (e.g., 'Pending', 'In Progress', 'Completed', 'Canceled')."
        },
        "orderedAt": {
          "type": "string",
          "description": "The timestamp when the service was ordered by the customer.",
          "format": "date-time"
        },
        "completedAt": {
          "type": "string",
          "description": "The timestamp when the service order was marked as completed.",
          "format": "date-time"
        },
        "customerNotes": {
          "type": "string",
          "description": "Any specific instructions or notes provided by the customer for this service order."
        },
        "employeeNotes": {
          "type": "string",
          "description": "Internal notes added by employees regarding the service order."
        }
      },
      "required": [
        "id",
        "projectId",
        "serviceId",
        "status",
        "orderedAt"
      ]
    },
    "Job": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Job",
      "type": "object",
      "description": "Represents a single executable task or unit of work related to a ServiceOrder, often performed by an AI agent or an employee.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Job entity."
        },
        "serviceOrderId": {
          "type": "string",
          "description": "Reference to the ServiceOrder entity that this job is part of. (Relationship: ServiceOrder 1:N Job)"
        },
        "projectId": {
          "type": "string",
          "description": "Reference to the Project entity this job belongs to. (Relationship: Project 1:N Job)"
        },
        "serviceId": {
          "type": "string",
          "description": "Reference to the Service entity this job is executing. (Relationship: Service 1:N Job)"
        },
        "name": {
          "type": "string",
          "description": "A descriptive name for the job (e.g., 'Generate 3 images for Product XYZ')."
        },
        "status": {
          "type": "string",
          "description": "The current status of the job (e.g., 'Queued', 'Running', 'Completed', 'Failed', 'AwaitingReview')."
        },
        "assignedEmployeeId": {
          "type": "string",
          "description": "Reference to the Employee entity who is assigned to or last worked on this job. (Relationship: Employee 1:N Job)"
        },
        "inputs": {
          "type": "string",
          "description": "A JSON string containing specific input parameters for this job (e.g., product images, title, desired style)."
        },
        "output": {
          "type": "string",
          "description": "A JSON string containing the result or output generated by the AI agent or employee (e.g., generated text, image URLs, video links)."
        },
        "logs": {
          "type": "array",
          "description": "An array of log entries or messages related to the job's execution.",
          "items": {
            "type": "string"
          }
        },
        "startedAt": {
          "type": "string",
          "description": "The timestamp when the job execution started.",
          "format": "date-time"
        },
        "completedAt": {
          "type": "string",
          "description": "The timestamp when the job execution was completed.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the job was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The timestamp when the job was last updated.",
          "format": "date-time"
        },
        "outputPreviewLink": {
          "type": "string",
          "description": "A URL to a temporary preview of the job's output.",
          "format": "uri"
        },
        "exportedFileLink": {
          "type": "string",
          "description": "A URL to the final exported file (e.g., .txt, .csv, .pdf) generated by the job.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "serviceOrderId",
        "projectId",
        "serviceId",
        "name",
        "status",
        "inputs",
        "output",
        "logs",
        "createdAt",
        "updatedAt"
      ]
    },
    "APIKeyConfiguration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "APIKeyConfiguration",
      "type": "object",
      "description": "Stores API keys and configurations for external services used by the agency's AI agents.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the APIKeyConfiguration entity."
        },
        "serviceName": {
          "type": "string",
          "description": "The name of the external service (e.g., 'OpenAI', 'DALL-E', 'Midjourney', 'Runway', 'Pika', 'Meta Ads', 'Google Analytics')."
        },
        "apiKey": {
          "type": "string",
          "description": "The API key for the external service (should be stored securely in a production environment)."
        },
        "description": {
          "type": "string",
          "description": "A description of this API key configuration."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if this API key configuration is currently active and in use."
        },
        "configuredByEmployeeId": {
          "type": "string",
          "description": "Reference to the Employee entity who last configured or updated this API key. (Relationship: Employee 1:N APIKeyConfiguration)"
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the API key configuration was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The timestamp when the API key configuration was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "serviceName",
        "apiKey",
        "isActive",
        "configuredByEmployeeId",
        "createdAt",
        "updatedAt"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product managed by a customer within a project, including details like images, categories, and marketplace-specific identifiers.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to the Project entity this product belongs to. (Relationship: Project 1:N Product)"
        },
        "name": {
          "type": "string",
          "description": "The title or name of the product."
        },
        "category": {
          "type": "string",
          "description": "The category of the product."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the product."
        },
        "imageUrls": {
          "type": "array",
          "description": "An array of URLs pointing to images of the product.",
          "items": {
            "type": "string"
          }
        },
        "asin": {
          "type": "string",
          "description": "The Amazon Standard Identification Number (ASIN) for the product, if applicable."
        },
        "sku": {
          "type": "string",
          "description": "The Stock Keeping Unit (SKU) for the product, if applicable."
        },
        "productUrl": {
          "type": "string",
          "description": "A URL directly linking to the product's listing on a marketplace, used for intelligence agents.",
          "format": "uri"
        },
        "marketplaceData": {
          "type": "string",
          "description": "A JSON string containing marketplace-specific data for the product (e.g., Flipkart listing ID, Myntra product ID)."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the product record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The timestamp when the product record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "projectId",
        "name",
        "category",
        "imageUrls",
        "createdAt",
        "updatedAt"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification to be delivered to either a customer or an employee within the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Notification entity."
        },
        "recipientId": {
          "type": "string",
          "description": "Reference to the UserProfile or Employee entity who is the recipient of this notification. (Relationship: UserProfile/Employee 1:N Notification)"
        },
        "recipientType": {
          "type": "string",
          "description": "Indicates whether the recipient is a 'Customer' (UserProfile) or an 'Employee'."
        },
        "type": {
          "type": "string",
          "description": "The type of notification (e.g., 'JobStatusUpdate', 'NewServiceOrder', 'APIKeyExpired')."
        },
        "message": {
          "type": "string",
          "description": "The content of the notification message."
        },
        "isRead": {
          "type": "boolean",
          "description": "A boolean indicating whether the recipient has read the notification."
        },
        "linkedEntityId": {
          "type": "string",
          "description": "The ID of the entity (e.g., Job, ServiceOrder) that this notification pertains to. (Relationship: Generic 1:N Notification)"
        },
        "linkedEntityType": {
          "type": "string",
          "description": "The type of the entity that this notification pertains to (e.g., 'Job', 'ServiceOrder', 'APIKeyConfiguration')."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the notification was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "recipientId",
        "recipientType",
        "type",
        "message",
        "isRead",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/userProfiles/{userProfileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores individual customer profiles. Access is restricted to the authenticated user matching {userProfileId} for read/write. This forms the root of customer-specific data authorization and is a key for path-based ownership."
        }
      },
      {
        "path": "/employees/{employeeId}",
        "definition": {
          "entityName": "Employee",
          "schema": {
            "$ref": "#/backend/entities/Employee"
          },
          "description": "Stores internal employee profiles and roles. Access is restricted to the authenticated employee matching {employeeId} for self-profile access. Employees with an 'Admin' role can manage other employee profiles and roles. This collection is crucial for internal role-based access control (DBAC) through the 'role' field."
        }
      },
      {
        "path": "/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Represents customer projects. Stored as a top-level collection to enable query-all-projects (QAPs) for employees/admins. Includes denormalized 'userProfileId' (from the owning UserProfile) for customer-specific authorization independence, allowing customers to access their projects without needing to traverse their UserProfile path or perform document gets in rules. Employees/admins can list all projects and view details."
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information related to a specific project. Stored as a top-level collection for employee/agent access (QAPs). Includes denormalized 'userProfileId' (from the owning UserProfile) and 'projectId' (from the parent Project) for authorization independence, allowing customers to manage their products and employees/agents to access product data for job execution without hierarchical rule dependencies."
        }
      },
      {
        "path": "/services/{serviceId}",
        "definition": {
          "entityName": "Service",
          "schema": {
            "$ref": "#/backend/entities/Service"
          },
          "description": "Defines available AI services offered by the agency. This is a global collection, publicly readable by all authenticated users (customers to browse, employees to reference). Only 'Admin' employees have write access for managing service offerings, ensuring structural segregation of global, publicly-viewable data."
        }
      },
      {
        "path": "/promptTemplates/{promptTemplateId}",
        "definition": {
          "entityName": "PromptTemplate",
          "schema": {
            "$ref": "#/backend/entities/PromptTemplate"
          },
          "description": "Stores reusable AI prompt templates. Managed internally by employees, with 'Admin' roles having write access. Employees can read these templates to configure AI agents. Customers do not directly interact with this collection, adhering to structural segregation for internal tools and configurations."
        }
      },
      {
        "path": "/serviceOrders/{serviceOrderId}",
        "definition": {
          "entityName": "ServiceOrder",
          "schema": {
            "$ref": "#/backend/entities/ServiceOrder"
          },
          "description": "Represents a customer's order for a service. Stored as a top-level collection for employee/admin visibility and QAPs. Includes denormalized 'userProfileId' (from the owning UserProfile) and 'projectId' (from the parent Project) for customer authorization independence and context. Customers can track their own orders, and employees can manage all service orders efficiently."
        }
      },
      {
        "path": "/jobs/{jobId}",
        "definition": {
          "entityName": "Job",
          "schema": {
            "$ref": "#/backend/entities/Job"
          },
          "description": "Represents an executable task within a service order, performed by AI or employees. Stored as a top-level collection for employee/admin visibility and QAPs. Includes denormalized 'userProfileId' (from the owning UserProfile), 'projectId' (from Project), 'serviceOrderId' (from ServiceOrder), and 'assignedEmployeeId' for full authorization independence. Customers can view their job progress, and employees can manage and fulfill assigned jobs."
        }
      },
      {
        "path": "/apiKeyConfigurations/{configId}",
        "definition": {
          "entityName": "APIKeyConfiguration",
          "schema": {
            "$ref": "#/backend/entities/APIKeyConfiguration"
          },
          "description": "Stores sensitive API keys for external services. This is a highly restricted collection. Only 'Admin' employees have read/write access to maintain security and control over critical configurations, ensuring strict structural segregation for sensitive credentials."
        }
      },
      {
        "path": "/userProfiles/{userProfileId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores notifications specifically for customers. Access is strictly controlled by path-based ownership: only the authenticated user matching {userProfileId} can read/write their own notifications. This ensures privacy and clear segregation from employee notifications through structural segregation."
        }
      },
      {
        "path": "/employees/{employeeId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores notifications specifically for internal employees. Access is strictly controlled by path-based ownership: only the authenticated employee matching {employeeId} can read/write their own notifications. This ensures privacy and clear segregation from customer notifications through structural segregation."
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to robustly handle both customer-facing and internal employee/admin functionalities, prioritizing security, scalability, and debuggability as per the core design principles. The key strategy employed is **Authorization Independence via Denormalization** for data accessible by multiple user types (customers and employees) and **Structural Segregation** to simplify security rules.Customer-specific data like `UserProfile` and their `Notifications` are stored in path-based private collections (`/userProfiles/{userProfileId}` and `/userProfiles/{userProfileId}/notifications`). This leverages Firebase Authentication's `request.auth.uid` directly within the path for simple, explicit ownership rules.Internal employee data (`Employee`) and their `Notifications` follow a similar path-based ownership pattern (`/employees/{employeeId}` and `/employees/{employeeId}/notifications`), allowing employees to manage their own profiles and receive private notifications, while also enabling rule-based access for 'Admin' roles to manage other employee profiles.Global entities or those requiring broad access for internal management, such as `Service`, `PromptTemplate`, and `APIKeyConfiguration`, are placed in top-level collections (`/services`, `/promptTemplates`, `/apiKeyConfigurations`). These collections have clearly defined access patterns: `Service` is readable by all authenticated users but writable only by Admins; `PromptTemplate` is employee-readable and Admin-writable; and `APIKeyConfiguration` is strictly Admin-only for read/write access due to its sensitive nature.For entities like `Project`, `Product`, `ServiceOrder`, and `Job` that are owned by a customer but must also be accessible and queryable by employees (e.g., for task management, reporting, or AI agent execution), a crucial denormalization strategy is applied. These entities are stored as **top-level collections** (`/projects`, `/products`, `/serviceOrders`, `/jobs`), rather than nested under `/userProfiles`. Each document in these collections explicitly includes the `userProfileId` field (and `projectId` for `Product`, `ServiceOrder`, `Job`; and `serviceOrderId` for `Job`). This achieves **Authorization Independence** by eliminating the need for `get()` calls in security rules to check parent document ownership. A customer can be authorized to access their specific `Project`, `Product`, `ServiceOrder`, or `Job` document by simply checking `request.auth.uid == resource.data.userProfileId`.This top-level collection design, combined with denormalized ownership fields, directly supports **QAPs (Query-All-Permissions)**. Employees and administrators can perform `list` operations (e.g., `db.collection('serviceOrders').where('status', '==', 'Pending')`) across all customers without triggering inefficient or insecure `get()` calls in rules. This makes it scalable for dashboards and internal tools, as rules do not act as filters but rather enforce access based on explicit document fields.The use of a single `status` field for explicit state modeling (`DRAFT`, `PUBLISHED`, `Pending`, `In Progress`, etc.) ensures predictability and simplifies rule logic for state transitions. Wildcards are descriptive (e.g., `{userProfileId}`, `{projectId}`), enhancing clarity and debuggability. This structured approach, adhering to the mandated principles, results in a highly secure, performant, and maintainable Firestore database."
  }
}